---
title: "bm_exploration"
author: "benjamin Mai"
date: "19/11/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(dplyr)
library(readr)
library(tidyr)
```

## read

```{r}
data <- read.csv("../data-raw/incidents-responded-to-by-fire-companies.csv")
```

##study of the data

```{r}
summary(data)
dim(data)
names(data)
head(data)
View(data)
```

```{r}
#remove NA columns at the end
data <- data %>% select(1:17)
```


182 different types of issues
```{r}
#distinct issues
data %>% distinct(INCIDENT_TYPE_DESC)
```


```{r}
#evaluate number problems by issues
number_inter_by_issues <-  data %>% group_by(INCIDENT_TYPE_DESC) %>% 
  summarise(total = n()) %>% 
  arrange(desc(total))

nb_top20_inter <- sum(head(number_inter_by_issues, 20)$total)
nb_all_inter <- sum(number_inter_by_issues$total)

nb_top20_inter/nb_all_inter


```
we notice that 87.5% of all interventions concern only the top 20 biggest interventions (out of 182).


```{r}
data_by_year <- data %>% mutate(INCIDENT_DATE_TIME = substr(INCIDENT_DATE_TIME, 0, 4))
data_by_year

data_by_year %>% group_by(INCIDENT_DATE_TIME) %>% 
  summarise(total = n())
```
We notice that number of incidents seem quite stable over the 5 years with slightly lower incidents in 2013 and more in 2015. Why?? Influenced by what?? 

```{r}
data_by_month <- data %>% mutate(INCIDENT_DATE_TIME = substr(INCIDENT_DATE_TIME,6,7))

#total number of incidents by month over the last 5 years 
data_by_month %>% group_by(INCIDENT_DATE_TIME) %>% 
  summarise(total = n())
```
more accidents in july than in february! Due to what? Holidays? 

```{r}
#incidents by months
yo <- data_by_month %>% group_by(INCIDENT_DATE_TIME, INCIDENT_TYPE_DESC) %>% 
  summarise(total = n()) %>% 
  spread(key = INCIDENT_DATE_TIME, value = total)

yo[,2:13][is.na(yo[2:13])] <- 0 

yo <- yo %>%   
  mutate(sum_inci = rowSums(select(.,2:13))) %>% 
  arrange(desc(sum_inci))

View(yo)
```
We notice that depending on the incidents, there are some months where the number of incidents is considerable increased!

```{r}
#TOTAL NUMBER OF INCIDENTS BY HOURS
data_by_hours <- data %>% mutate(INCIDENT_DATE_TIME = substr(INCIDENT_DATE_TIME,12,13))

data_by_hours %>% group_by(INCIDENT_DATE_TIME) %>% summarise(total = n())
```
More incidents starting at 9 and more in the afternoon (pick ar 17H/18H as expected).

```{r}
#incidents by months
hours <- data_by_hours %>% group_by(INCIDENT_DATE_TIME, INCIDENT_TYPE_DESC) %>% 
  summarise(total = n()) %>% 
  spread(key = INCIDENT_DATE_TIME, value = total)

hours[,2:25][is.na(hours[2:25])] <- 0 

hours <- hours %>%   
  mutate(sum_inci = rowSums(select(.,2:25))) %>% 
  arrange(desc(sum_inci))

View(hours)
```

We need to need to make this distinction by days of the week very important!

##Analysis by places

Criterion to take into account: Period of the year (months), the time it is, the day of the week, the places, the weather!
